<!-- ═══ Panel: Backup ═══ -->
<div class="settings-panel" id="panel-backup">
    <!-- Manual Backup -->
    <div class="settings-card">
        <div class="settings-card-header">
            <div class="settings-card-icon"><i data-lucide="hard-drive-download"></i></div>
            <div>
                <div class="settings-card-title">{{ t.backup_title }}</div>
                <div class="settings-card-desc">{{ t.backup_desc }}</div>
            </div>
        </div>
        <div class="btn-row">
            <button type="button" class="btn btn-primary" onclick="downloadBackup()" id="backup-download-btn">
                <i data-lucide="download" style="width:16px;height:16px;"></i>
                {{ t.backup_download }}
            </button>
        </div>
        <div class="test-result" id="backup-download-result"></div>
    </div>

    <!-- Automatic Backups -->
    <div class="settings-card">
        <div class="settings-card-header">
            <div class="settings-card-icon"><i data-lucide="clock"></i></div>
            <div>
                <div class="settings-card-title">{{ t.backup_auto_label }}</div>
                <div class="settings-card-desc">{{ t.backup_auto_hint }}</div>
            </div>
        </div>

        <div class="toggle-option-row">
            <div class="toggle-option-text">
                <span class="toggle-option-label">{{ t.enabled }}</span>
            </div>
            <input type="hidden" name="backup_enabled" value="false">
            <label class="toggle-switch">
                <input type="checkbox" id="backup_enabled" name="backup_enabled" value="true" {% if config.backup_enabled %}checked{% endif %}>
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div id="backup-auto-settings" style="{% if not config.backup_enabled %}opacity:0.5;pointer-events:none;{% endif %}">
            <div class="form-row" style="margin-top:16px;">
                <label>{{ t.backup_path }}</label>
                <div style="display:flex;gap:8px;">
                    <input type="text" id="backup_path" name="backup_path" value="{{ config.backup_path }}" readonly style="flex:1;cursor:pointer;background:var(--bg);">
                    <button type="button" class="btn btn-secondary" onclick="openBrowseModal()" style="white-space:nowrap;">
                        <i data-lucide="folder-open" style="width:14px;height:14px;"></i>
                        {{ t.backup_browse }}
                    </button>
                </div>
                <span class="hint">{{ t.backup_path_hint }}</span>
            </div>
            <div class="form-grid">
                <div class="form-row">
                    <label for="backup_interval_hours">{{ t.backup_interval }}</label>
                    <select id="backup_interval_hours" name="backup_interval_hours">
                        <option value="24" {% if config.backup_interval_hours == 24 or not config.backup_interval_hours %}selected{% endif %}>{{ t.backup_daily }}</option>
                        <option value="168" {% if config.backup_interval_hours == 168 %}selected{% endif %}>{{ t.backup_weekly }}</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="backup_retention">{{ t.backup_retention }}</label>
                    <input type="number" id="backup_retention" name="backup_retention" value="{{ config.backup_retention or 5 }}" min="1" max="100">
                    <span class="hint">{{ t.backup_retention_hint }}</span>
                </div>
            </div>
            <div class="btn-row">
                <button type="button" class="btn btn-secondary" onclick="backupNow()">
                    <i data-lucide="save" style="width:14px;height:14px;"></i>
                    {{ t.backup_now }}
                </button>
            </div>
            <div class="test-result" id="backup-now-result"></div>

            <!-- Existing Backups List -->
            <div style="margin-top:24px;">
                <label style="font-size:0.875em;color:var(--text-secondary);font-weight:500;margin-bottom:8px;display:block;">{{ t.backup_existing }}</label>
                <div id="backup-list" style="font-size:0.85em;"></div>
            </div>
        </div>
    </div>
</div>

<!-- ═══ Directory Browser Modal ═══ -->
<div id="browse-modal" style="display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);align-items:center;justify-content:center;">
    <div style="background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius-lg);width:480px;max-width:90vw;max-height:70vh;display:flex;flex-direction:column;box-shadow:0 8px 32px rgba(0,0,0,0.4);">
        <div style="padding:20px 24px;border-bottom:1px solid var(--card-border);display:flex;align-items:center;justify-content:space-between;">
            <span style="font-weight:600;font-size:1.05em;color:var(--text);">{{ t.backup_select_dir }}</span>
            <button type="button" onclick="closeBrowseModal()" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:1.2em;padding:4px;">&#10005;</button>
        </div>
        <div id="browse-breadcrumb" style="padding:12px 24px;font-family:monospace;font-size:0.85em;color:var(--text-secondary);background:var(--bg);border-bottom:1px solid var(--card-border);word-break:break-all;"></div>
        <div id="browse-dirs" style="flex:1;overflow-y:auto;padding:8px 16px;min-height:200px;"></div>
        <div style="padding:16px 24px;border-top:1px solid var(--card-border);display:flex;gap:12px;justify-content:flex-end;">
            <button type="button" class="btn btn-secondary" onclick="closeBrowseModal()">{{ t.cancel }}</button>
            <button type="button" class="btn btn-primary" onclick="selectBrowsePath()">{{ t.backup_select }}</button>
        </div>
    </div>
</div>
