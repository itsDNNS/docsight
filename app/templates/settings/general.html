<!-- ═══ Panel: General ═══ -->
<div class="settings-panel" id="panel-general">
    <div class="settings-card">
        <div class="settings-card-header">
            <div class="settings-card-icon"><i data-lucide="settings"></i></div>
            <div>
                <div class="settings-card-title">{{ t.general }}</div>
            </div>
        </div>
        <div class="form-grid">
            <div class="form-row">
                <label for="isp_select">{{ t.isp_name }}</label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <select id="isp_select" name="isp_select" onchange="onIspChange()" style="flex:1;">
                        <option value="">{{ t.isp_select }}</option>
                        {% for isp in t.isp_options %}
                        <option value="{{ isp }}" {% if config.isp_name == isp %}selected{% endif %}>{{ isp }}</option>
                        {% endfor %}
                        <option value="__other__" {% if config.isp_name and config.isp_name not in t.isp_options %}selected{% endif %}>{{ t.isp_other }}</option>
                    </select>
                    <img id="isp-icon-preview" src="" alt="" style="width:20px;height:20px;display:none;">
                </div>
                <span class="hint">{{ t.isp_hint }}</span>
            </div>
            <div class="form-row" id="isp-other-row" style="display:{% if config.isp_name and config.isp_name not in t.isp_options %}flex{% else %}none{% endif %}">
                <label for="isp_other_input">{{ t.isp_other }}</label>
                <input type="text" id="isp_other_input" value="{% if config.isp_name and config.isp_name not in t.isp_options %}{{ config.isp_name }}{% endif %}" placeholder="{{ t.isp_other_placeholder }}">
            </div>
            <div class="form-row">
                <label for="poll_interval">{{ t.interval_sec }}</label>
                <input type="number" id="poll_interval" name="poll_interval" value="{{ config.poll_interval }}" min="{{ poll_min }}" max="{{ poll_max }}">
                <span class="hint">Min: {{ poll_min }}s / Max: {{ poll_max }}s</span>
            </div>
            <div class="form-row">
                <label for="history_days">{{ t.history_days }}</label>
                <input type="number" id="history_days" name="history_days" value="{{ config.history_days }}" min="0">
                <span class="hint">{{ t.history_hint }}</span>
            </div>
            <div class="form-row">
                <label for="snapshot_time">{{ t.snapshot_time }}</label>
                <input type="time" id="snapshot_time" name="snapshot_time" value="{{ config.snapshot_time }}">
                <span class="hint" id="snapshot-tz-hint">{{ t.snapshot_hint }}</span>
            </div>
            <div class="form-row">
                <label for="timezone">{{ t.timezone }}</label>
                <select id="timezone" name="timezone">
                    <option value="">{{ t.timezone_auto }} ({{ server_tz }})</option>
                    {% for tz in timezones %}
                    <option value="{{ tz }}" {% if config.timezone == tz %}selected{% endif %}>{{ tz }}</option>
                    {% endfor %}
                </select>
                <span class="hint">{{ t.timezone_hint }}</span>
                {% if tz_is_posix and not config.timezone %}
                <span class="hint" style="color: var(--warning, #e6a700); margin-top: 4px; display: block;">
                    ⚠ {{ t.timezone_posix_warning|default('Your container uses "' + server_tz + '" which does not support daylight saving time. Select an IANA timezone (e.g. Europe/Berlin) to fix this.') }}
                </span>
                {% endif %}
            </div>
            <div class="form-row">
                <label for="language">{{ t.language }}</label>
                <select id="language" name="language">
                    {% for code, name in languages.items() %}
                    <option value="{{ code }}" {% if code == lang %}selected{% endif %}>{{ name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-row">
                <label for="admin_password">{{ t.admin_password }}</label>
                <input type="password" id="admin_password" name="admin_password" value="{{ config.admin_password }}" placeholder="{{ t.admin_password_hint }}">
                <span class="hint">{{ t.admin_password_hint }}</span>
            </div>
        </div>
    </div>

    <!-- API Tokens (only when password is set) -->
    {% if config.admin_password %}
    <div class="settings-card" id="api-tokens-card">
        <div class="settings-card-header">
            <div class="settings-card-icon"><i data-lucide="key-round"></i></div>
            <div>
                <div class="settings-card-title">{{ t.api_tokens_title|default('API Tokens') }}</div>
                <div class="settings-card-desc">{{ t.api_tokens_desc|default('Create tokens for programmatic API access') }}</div>
            </div>
        </div>
        <div style="padding: 0 16px 16px;">
            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                <input type="text" id="api-token-name" placeholder="{{ t.api_token_name_placeholder|default('e.g. Home Assistant') }}" style="flex: 1;">
                <button type="button" class="btn btn-primary" onclick="createApiToken()">
                    <i data-lucide="plus" style="width:16px;height:16px;"></i>
                    {{ t.api_token_create|default('Create Token') }}
                </button>
            </div>
            <div id="api-token-created-banner" style="display: none; background: var(--card-bg, #1a1d23); border: 1px solid var(--accent, #4f8cff); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                <div style="font-weight: 600; margin-bottom: 4px;">{{ t.api_token_created|default('Token created. Copy it now.') }}</div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <code id="api-token-plaintext" style="flex: 1; word-break: break-all; font-size: 0.85em; padding: 6px 8px; background: var(--bg, #12141a); border-radius: 4px;"></code>
                    <button type="button" class="btn" onclick="copyToken()" style="white-space: nowrap;">
                        <i data-lucide="copy" style="width:14px;height:14px;"></i>
                    </button>
                </div>
                <div style="font-size: 0.8em; opacity: 0.7; margin-top: 6px;">{{ t.api_token_copy_warning|default('This token will only be shown once.') }}</div>
            </div>
            <table id="api-tokens-table" style="width: 100%; font-size: 0.9em; display: none;">
                <thead>
                    <tr style="text-align: left; opacity: 0.7;">
                        <th style="padding: 4px 8px;">{{ t.api_token_name|default('Name') }}</th>
                        <th style="padding: 4px 8px;">{{ t.api_token_prefix|default('Token') }}</th>
                        <th style="padding: 4px 8px;">{{ t.api_token_last_used|default('Last Used') }}</th>
                        <th style="padding: 4px 8px;"></th>
                    </tr>
                </thead>
                <tbody id="api-tokens-body"></tbody>
            </table>
            <div id="api-tokens-empty" style="opacity: 0.6; font-size: 0.9em;">{{ t.api_tokens_none|default('No API tokens created yet.') }}</div>
        </div>
    </div>
    {% endif %}
</div>
